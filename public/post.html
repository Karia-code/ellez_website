<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ELLEZ – Update</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="nav-logo">
        <img src="/LOGO-.png" alt="ELLEZ LLC" class="nav-logo-img" />
        <span class="nav-logo-text">ELLEZ</span>
      </a>
      <ul class="nav-links">
        <li><a href="/">Home</a></li>
      </ul>
    </div>
  </nav>

  <main id="site-main" class="fade-in-section">
    <section class="about" style="padding-top: 120px;">
      <div class="container">
        <div id="post-meta" style="margin-bottom: 24px; font-family: monospace; font-size: 12px; opacity: .8;"></div>
        <h1 id="post-title" class="section-title">Loading…</h1>
        <article id="post-content" class="about-text" style="white-space: pre-wrap; line-height: 1.7; margin-top: 16px;">Please wait while we load the content.</article>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-bottom">
      <p>&copy; 2025 ELLEZ LLC. All rights reserved.</p>
    </div>
  </footer>

  <!-- Inline module script using Firebase CDN (no bundler needed) -->
  <script type="module">
    // Public Firebase web config (safe to expose)
    const firebaseConfig = {
      apiKey: "AIzaSyCYi-6vZqsSsI6X1hhXHcABR--MlD3-mTY",
      authDomain: "ellez-site.firebaseapp.com",
      projectId: "ellez-site",
      storageBucket: "ellez-site.firebasestorage.app",
      messagingSenderId: "161384067066",
      appId: "1:161384067066:web:22fd7fa7e6d6dbfa023e43",
      measurementId: "G-3LRGF5R73H"
    };

    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
    const { getFirestore, collection, query, where, limit, getDocs } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function getSlugFromLocation() {
      const path = location.pathname;
      const updatesPrefix = '/updates/';
      if (path.startsWith(updatesPrefix)) {
        return decodeURIComponent(path.substring(updatesPrefix.length));
      }
      const url = new URL(location.href);
      const p = url.searchParams.get('slug');
      return p ? decodeURIComponent(p) : '';
    }

    function setText(id, text) {
      const el = document.getElementById(id);
      if (el) el.textContent = text || '';
    }

    function setMeta({ lang, dateStr, category }) {
      const meta = document.getElementById('post-meta');
      if (!meta) return;
      const parts = [];
      if (lang) parts.push(`[${String(lang).toUpperCase()}]`);
      if (dateStr) parts.push(dateStr);
      if (category) parts.push(category);
      meta.textContent = parts.join(' • ');
    }

    async function loadPost() {
      const slug = getSlugFromLocation();
      if (!slug) {
        setText('post-title', 'Post not found');
        setText('post-content', 'Invalid URL.');
        return;
      }

      try {
        const q = query(
          collection(db, 'updates'),
          where('slug', '==', slug),
          limit(1)
        );
        const snap = await getDocs(q);
        if (snap.empty) {
          setText('post-title', 'Post not found');
          setText('post-content', 'This update may have been removed or the link is incorrect.');
          return;
        }

        const data = snap.docs[0].data();
        setText('post-title', data.title || 'Untitled');
        setText('post-content', data.content || '');
        setMeta({ lang: data.lang, dateStr: data.dateStr, category: data.category });
        document.title = `ELLEZ – ${data.title || 'Update'}`;
      } catch (err) {
        console.error('Failed to load post:', err);
        setText('post-title', 'Error loading post');
        setText('post-content', 'Please try again later.');
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadPost);
    } else {
      loadPost();
    }
  </script>
</body>
</html>
